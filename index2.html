<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Diamante del Mar Phaedra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .section-screen, #concierge-chat {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(247, 250, 252, 0.95); /* light gray with transparency */
            backdrop-filter: blur(10px);
            z-index: 50;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .section-screen.active, #concierge-chat.active {
            transform: translateX(0);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .grid-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            border-radius: 1rem;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid rgba(226, 232, 240, 1);
            transition: all 0.2s ease-in-out;
        }
        .grid-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .section-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        .prose-custom p, .prose-custom li {
            color: #4A5568;
        }
        .prose-custom h3 {
            color: #2D3748;
            font-weight: 600;
        }
        #home-screen {
            background-image: url('https://images.unsplash.com/photo-1602261595832-de4243563a33?q=80&w=1974&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        .chat-bubble {
            max-width: 75%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
        }
        .user-bubble {
            background-color: #3b82f6;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .ai-bubble {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="max-w-md mx-auto min-h-screen bg-gray-100">
        
        <div id="home-screen" class="relative min-h-screen">
             <div class="absolute inset-0 bg-black/30"></div>
            <div class="relative z-10 p-6 pt-16">
                 <div class="text-center mb-8 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg">
                    <h1 class="text-3xl font-bold text-gray-800">Welcome Book</h1>
                </div>
                <main>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="showSection('welcome-section')" class="grid-button">
                            <i data-lucide="sun" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Welcome</span>
                        </button>
                        <button onclick="showSection('essentials-section')" class="grid-button">
                            <i data-lucide="key-round" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Apartment Info</span>
                        </button>
                        <button onclick="showSection('guide-section')" class="grid-button">
                            <i data-lucide="map" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Island Guide</span>
                        </button>
                        <button onclick="showConcierge()" class="grid-button">
                            <i data-lucide="bot" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Digital AI Concierge</span>
                        </button>
                        <button onclick="showSection('events-section')" class="grid-button">
                            <i data-lucide="calendar-days" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Events in Kos</span>
                        </button>
                        <button onclick="showSection('local-products-section')" class="grid-button">
                            <i data-lucide="shopping-bag" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Local Products</span>
                        </button>
                        <button onclick="showSection('itinerary-section')" class="grid-button">
                            <i data-lucide="list-checks" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Itinerary</span>
                        </button>
                        <button onclick="showSection('island-hopping-section')" class="grid-button">
                            <i data-lucide="sailboat" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Island Hopping</span>
                        </button>
                        <button onclick="showSection('transport-section')" class="grid-button">
                            <i data-lucide="bus" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Getting Around</span>
                        </button>
                        <button onclick="showSection('important-section')" class="grid-button">
                            <i data-lucide="siren" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Important Info</span>
                        </button>
                        <button onclick="showSection('departure-section')" class="grid-button">
                            <i data-lucide="log-out" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Departure</span>
                        </button>
                    </div>
                </main>
            </div>
        </div>

        <div id="welcome-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Welcome to Paradise!</h2>
            </header>
            <div class="p-6 prose-custom">
                <h3 class="text-2xl font-bold mb-4">Kalós órises!</h3>
                <p class="mb-4">Welcome to Kos, and welcome to Diamante del Mar Phaedra. We are absolutely delighted to host you on this enchanting Dodecanese island. Recently renovated and designed with style and comfort in mind, we hope our home serves as your perfect sanctuary to explore the captivating blend of ancient history, sun-drenched beaches, and vibrant island life that makes Kos so special.</p>
            </div>
        </div>

        <div id="essentials-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Apartment Info</h2>
            </header>
            <div class="p-6 space-y-6">
                <div class="card p-6">
                    <h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="map-pin" class="w-5 h-5 mr-2 text-blue-500"></i>Address</h3>
                    <p class="text-gray-600">Diamante Del Mar Phaedra, Sophokli Venizelou 54, Kos Town, 853 00</p>
                </div>
                <div class="card p-6">
                    <h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="clock" class="w-5 h-5 mr-2 text-blue-500"></i>Check-in & Out</h3>
                    <p class="text-gray-600"><strong>Check-in:</strong> After 16:00 (4:00 PM) | <strong>Lockbox Code:</strong> 1723</p>
                    <p class="text-gray-600 mt-2"><strong>Check-out:</strong> By 11:00 AM</p>
                </div>
                <div class="card p-6">
                    <h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="wifi" class="w-5 h-5 mr-2 text-blue-500"></i>Wi-Fi Access</h3>
                    <p class="text-gray-600"><strong>Network:</strong> Phaedra | <strong>Password:</strong> <span id="wifi-password">Phaedra!22420@</span></p>
                </div>
            </div>
        </div>

        <div id="guide-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Island Guide</h2>
            </header>
            <div class="p-6 space-y-8">
                 <div class="card overflow-hidden p-0">
                    <img src="https://images.unsplash.com/photo-1551028150-64b9f398f67b?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://xasapaki.gr/wp-content/uploads/2023/05/DSC01818-scaled.jpg';" alt="A perfectly grilled steak" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-xl mb-2 text-blue-800"><i data-lucide="star" class="w-6 h-6 mr-2 text-yellow-500 fill-current inline"></i>Host's Top Pick: Xasapaki</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="transport-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Getting Around Kos</h2>
            </header>
        </div>

        <div id="important-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Important Info</h2>
            </header>
        </div>

        <div id="departure-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Until Next Time...</h2>
            </header>
        </div>
        
        <div id="events-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Events in Kos</h2>
            </header>
        </div>

        <div id="local-products-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Local Products of Kos</h2>
            </header>
            <div class="p-6 space-y-8">
                <p class="text-gray-700 mb-4">Kos is rich in local produce and traditional goods. Here are some of our favorites. Click the button on any product to get a recipe idea from our AI chef!</p>
                
                <div class="card overflow-hidden p-0">
                    <img src="https://melitaygetos.gr/wp-content/uploads/2021/05/meli-1.jpg" onerror="this.onerror=null;this.src='https://www.kos.gr/sites/default/files/styles/flexslider_full/public/2020-03/melikoukouvas.jpg?itok=f4f4f4f4';" alt="Kos Honey" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-xl mb-2 text-gray-800">Kos Honey</h3>
                        <p class="text-gray-600 mb-3">Known for its excellent thyme honey, rich in aroma and flavor.</p>
                        <button onclick="getRecipe('Kos Thyme Honey')" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i> Suggest a Recipe
                        </button>
                    </div>
                </div>

                 <div class="card overflow-hidden p-0">
                    <img src="https://gastronomytours.com/wp-content/uploads/2023/09/Possa-768x443.jpg" onerror="this.onerror=null;this.src='https://www.kos.gr/sites/default/files/styles/flexslider_full/public/2020-03/tyriposa.jpg?itok=f4f4f4f4';" alt="Posa Cheese" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-xl mb-2 text-gray-800">Posa Cheese (Wine Cheese)</h3>
                        <p class="text-gray-600 mb-3">A unique local cheese aged in red wine sediment, giving it a distinctive reddish hue and a rich, spicy flavor.</p>
                        <button onclick="getRecipe('Posa Cheese (Greek wine cheese)')" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i> Suggest a Recipe
                        </button>
                    </div>
                </div>

                <div class="card overflow-hidden p-0">
                    <img src="https://lerosisland.gr/wp-content/uploads/2017/05/photo_2017-02-07_11-58-13-1.jpg" onerror="this.onerror=null;this.src='https://www.kos.gr/sites/default/files/styles/flexslider_full/public/2020-03/glykotomatas.jpg?itok=f4f4f4f4';" alt="Tomato Spoon Sweet" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-xl mb-2 text-gray-800">Tomato Spoon Sweet</h3>
                        <p class="text-gray-600 mb-3">A traditional Greek "spoon sweet" made from small, unripe tomatoes. It's candied and has a unique, delightful flavor.</p>
                        <button onclick="getRecipe('Greek Tomato Spoon Sweet')" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i> Suggest a Recipe
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <div id="itinerary-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Kos Itinerary Planner</h2>
            </header>
            <div class="p-6 space-y-8">
                <div class="card p-6 bg-blue-50 border border-blue-200">
                    <h3 class="font-bold text-xl mb-2 text-blue-800">✨ Personalize Your Trip</h3>
                    <p class="text-blue-700 mb-4">Tell us what you like, and our AI assistant will craft a custom itinerary just for you!</p>
                    <div class="space-y-4">
                        <div>
                            <label for="interests" class="block text-sm font-medium text-gray-700">What are your interests?</label>
                            <input type="text" id="interests" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="e.g., history, beaches, food, relaxing">
                        </div>
                        <div>
                            <label for="duration" class="block text-sm font-medium text-gray-700">How many days?</label>
                            <input type="number" id="duration" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" value="5" min="1" max="10">
                        </div>
                        <button onclick="generateItinerary()" class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i>
                            Generate My Itinerary
                        </button>
                    </div>
                </div>

                <div id="itinerary-result" class="space-y-4">
                     <div class="prose-custom">
                        <h3>Suggested 5-Day Itinerary</h3>
                        <p>Here's a suggested 5-day itinerary to help you make the most of your visit to Kos Island, blending history, relaxation, and local experiences.</p>
                        <h4>Day 1: Ancient History & Kos Town Charm</h4>
                        <ul>
                            <li>Explore the Castle of Neratzia at the harbor entrance.</li>
                            <li>Wander through the ancient Agora and visit the Roman Odeon.</li>
                            <li>Enjoy dinner at a local restaurant in Eleftherias Square.</li>
                        </ul>
                        <h4>Day 2: Healing History & Mountain Village Sunset</h4>
                        <ul>
                            <li>Visit the Asklepion, the ancient healing center.</li>
                            <li>Have lunch in the picturesque mountain village of Zia.</li>
                            <li>Experience a breathtaking sunset from Zia.</li>
                        </ul>
                     </div>
                </div>
            </div>
        </div>

        <div id="island-hopping-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Island Hopping from Kos</h2>
            </header>
        </div>

        <div id="concierge-chat" class="flex flex-col h-full">
            <header class="section-header p-4 flex items-center shadow-md flex-shrink-0">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Digital AI Concierge</h2>
            </header>
            <div id="chat-window" class="flex-grow p-4 overflow-y-auto flex flex-col">
                 <div class="chat-bubble ai-bubble">
                    Hello! How can I help you today? Ask me anything about the apartment, the island, or local recommendations.
                </div>
            </div>
            <div class="p-4 bg-white border-t border-gray-200 flex-shrink-0">
                <div class="flex items-center">
                    <input type="text" id="chat-input" class="w-full border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your message...">
                    <button onclick="sendMessage()" class="ml-3 bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
        Password copied to clipboard!
    </div>

    <div id="recipe-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-[60] hidden">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="recipe-modal-title">Recipe Suggestion</h3>
                <div id="recipe-modal-content" class="mt-2 px-7 py-3 text-left prose-custom">
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-recipe-modal" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let currentSection = null;
        const homeScreen = document.getElementById('home-screen');
        const conciergeScreen = document.getElementById('concierge-chat');

        const knowledgeBase = {
            "welcome": "Welcome to Diamante del Mar Phaedra on the beautiful island of Kos! We're happy to have you.",
            "address": "The address is Diamante Del Mar Phaedra, Σοφοκλή Βενιζέλου 54 (Sophokli Venizelou 54), Kos Town, 853 00.",
            "check-in": "Check-in is any time after 4:00 PM (16:00). The lockbox code is 1723.",
            "check-out": "Check-out is by 11:00 AM. Please leave the keys in the lockbox.",
            "wifi": "The Wi-Fi network is 'Phaedra' and the password is 'Phaedra!22420@'.",
            "rules": "The main house rules are: no smoking indoors, no pets, no parties, and quiet hours are from 10:00 PM to 7:00 AM.",
            "host": "The host is Varthakouris Ioannis. You can reach him on WhatsApp or by phone at +30 6942 575314 for urgent issues.",
            "emergency": "The general emergency number is 112. Ambulance is 166, Police is 100, and Fire Department is 199.",
            "supermarket": "The nearest supermarket is AB Vassilopoulos, just a 1-minute walk away. There is also an ATM at its entrance.",
            "restaurant recommendation": "The host's top pick is Xasapaki, a unique butcher shop and steakhouse. Other great options include Alchimion & The Cup for brunch, Barbouni for seafood, and Patriko for authentic Greek meze.",
            "beach recommendation": "Lambi Beach is the closest. For a photogenic spot, visit Agios Stefanos. For a unique natural spa, go to Therma Beach. Paradise Beach is great for families.",
            "history recommendation": "You should visit The Asklepion, the most important archaeological site. Also, explore Zia Village for sunset views and Neratzia Castle by the harbor.",
        };

        function findAnswerInContent(question) {
            const q = question.toLowerCase();
            for (const key in knowledgeBase) {
                if (q.includes(key)) return knowledgeBase[key];
            }
            if (q.includes('eat') || q.includes('food')) return knowledgeBase['restaurant recommendation'];
            if (q.includes('swim') || q.includes('sand')) return knowledgeBase['beach recommendation'];
            if (q.includes('contact') || q.includes('help')) return knowledgeBase['host'];
            return null;
        }

        async function callGemini(prompt, targetElement) {
            if (targetElement) {
                targetElement.innerHTML = '<div class="flex justify-center items-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div><span class="ml-3 text-gray-600">Our AI is crafting your response...</span></div>';
            }
            
            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "AIzaSyDd1fUY4syyAvclAWcVo0mr8nsnvbAZLQ4"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) { throw new Error(`API request failed with status ${response.status}`); }

                const result = await response.json();
                let text = "Sorry, I couldn't get a response. Please try again.";
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    text = result.candidates[0].content.parts[0].text;
                }
                
                if (targetElement) {
                    targetElement.innerHTML = text.replace(/(\r\n|\n|\r)/gm, "<br>");
                }
                return text;

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                const errorMsg = "<p>I'm having trouble connecting to the AI assistant right now. Please try again in a moment.</p>";
                if(targetElement){
                    targetElement.innerHTML = errorMsg;
                }
                return "I'm having trouble connecting. Please check the console for more details.";
            }
        }

        async function askGemini(question) {
            const loadingBubble = addMessageToChat("", "ai-bubble");
            loadingBubble.innerHTML = '<div class="flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900"></div></div>';
            
            const prompt = `You are a friendly digital concierge for a holiday apartment in Kos, Greece. Answer the following question concisely and helpfully. Question: "${question}"`;
            const responseText = await callGemini(prompt, null);
            loadingBubble.textContent = responseText;
        }

        function sendMessage() {
            const chatInput = document.getElementById('chat-input');
            const message = chatInput.value.trim();
            if (message) {
                addMessageToChat(message, 'user-bubble');
                chatInput.value = '';
                const localAnswer = findAnswerInContent(message);
                if (localAnswer) {
                    setTimeout(() => addMessageToChat(localAnswer, 'ai-bubble'), 500);
                } else {
                    askGemini(message);
                }
            }
        }

        function addMessageToChat(message, bubbleClass) {
            const chatWindow = document.getElementById('chat-window');
            const el = document.createElement('div');
            el.className = `chat-bubble ${bubbleClass}`;
            el.textContent = message;
            chatWindow.appendChild(el);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return el;
        }

        document.getElementById('chat-input').addEventListener('keypress', e => e.key === 'Enter' && sendMessage());

        async function generateItinerary() {
            const interests = document.getElementById('interests').value || 'a mix of everything';
            const duration = document.getElementById('duration').value || 5;
            const resultDiv = document.getElementById('itinerary-result');
            const prompt = `I am a tourist in Kos, Greece. Create a personalized ${duration}-day itinerary for me. My interests are: ${interests}. Make it sound exciting. Include activities, sights, and food spots. Format as HTML with TailwindCSS classes. Start with a <h3> title. For each day, use a <h4> and a <ul>. Wrap the entire response in a div with class "prose-custom".`;
            await callGemini(prompt, resultDiv);
        }

        async function getRecipe(productName) {
            const modal = document.getElementById('recipe-modal');
            const modalTitle = document.getElementById('recipe-modal-title');
            const modalContent = document.getElementById('recipe-modal-content');
            modalTitle.textContent = `Recipe with ${productName}`;
            modal.classList.remove('hidden');
            const prompt = `Provide a simple, delicious recipe using "${productName}" from Kos, Greece, suitable for a tourist in a holiday apartment. Format as HTML. Use <h4> for 'Ingredients' and 'Instructions', then <p> or <ul> for the content.`;
            await callGemini(prompt, modalContent);
        }

        document.getElementById('close-recipe-modal').addEventListener('click', () => {
            document.getElementById('recipe-modal').classList.add('hidden');
        });

        function showSection(sectionId) {
            homeScreen.style.display = 'none';
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                currentSection = section;
                section.scrollTop = 0;
            }
        }
        
        function showConcierge() {
            homeScreen.style.display = 'none';
            conciergeScreen.classList.add('active');
            currentSection = conciergeScreen;
        }

        function goBack() {
            if (currentSection) {
                currentSection.classList.remove('active');
                currentSection = null;
            }
            setTimeout(() => { homeScreen.style.display = 'block'; }, 300);
        }

        function copyToClipboard(selector) {
            const text = document.querySelector(selector).innerText;
            navigator.clipboard.writeText(text).then(() => showToast());
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 2000);
        }
    </script>
</body>
</html>
