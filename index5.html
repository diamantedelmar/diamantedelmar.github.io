<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Diamante del Mar Phaedra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .section-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f7fafc; /* light gray */
            z-index: 50;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .section-screen.active {
            transform: translateX(0);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .grid-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 1rem;
            border-radius: 1rem;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid rgba(226, 232, 240, 1);
            transition: all 0.2s ease-in-out;
        }
        .grid-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .section-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        .prose-custom p, .prose-custom li {
            color: #4A5568;
        }
        .prose-custom h3 {
            color: #2D3748;
            font-weight: 600;
        }
        /* Styles for AI Chat */
        #ai-chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-bubble {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background-color: #4a90e2;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-bubble.assistant {
            background-color: #e2e8f0;
            color: #2d3748;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        .chat-bubble.assistant.typing {
            display: flex;
            align-items: center;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #94a3b8;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing-bounce 1.2s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) { animation-delay: -1.0s; }
        .typing-dot:nth-child(3) { animation-delay: -0.8s; }
        @keyframes typing-bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        #ai-chat-input-area {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
        }
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 400px;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="max-w-md mx-auto min-h-screen bg-gray-100">
        
        <div id="home-screen">
            <header class="relative">
                <img src="https://images.unsplash.com/photo-1590530325942-15f23e42b267?q=80&w=800&auto=format&fit=crop" 
                     onerror="this.onerror=null;this.src='https://diamantedelmar.github.io/phaedra.png';" 
                     alt="Phaedra" class="w-full h-72 object-cover">
                <div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-gray-100 to-transparent"></div>
            </header>
            <div class="p-6 -mt-16">
                 <div class="text-center mb-8 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg">
                    <h1 class="text-3xl font-bold text-gray-800">Welcome Book</h1>
                </div>
                <main>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="showSection('ai-assistant-section')" class="grid-button col-span-2 bg-blue-500 text-white border-blue-600 hover:bg-blue-600">
                            <i data-lucide="bot" class="w-10 h-10 text-white mb-2"></i>
                            <span class="font-semibold">Ask Phaedra AI</span>
                        </button>
                        <button onclick="showSection('welcome-section')" class="grid-button">
                            <i data-lucide="sun" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Welcome</span>
                        </button>
                        <button onclick="showSection('essentials-section')" class="grid-button">
                            <i data-lucide="key-round" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Apartment Info</span>
                        </button>
                        <button onclick="showSection('guide-section')" class="grid-button">
                            <i data-lucide="map" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Island Guide</span>
                        </button>
                        <button onclick="showSection('events-section')" class="grid-button">
                            <i data-lucide="calendar-days" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Events in Kos</span>
                        </button>
                        <button onclick="showSection('local-products-section')" class="grid-button">
                            <i data-lucide="shopping-bag" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Local Products</span>
                        </button>
                        <button onclick="showSection('itinerary-section')" class="grid-button">
                            <i data-lucide="list-checks" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Itinerary</span>
                        </button>
                        <button onclick="showSection('island-hopping-section')" class="grid-button">
                            <i data-lucide="sailboat" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Island Hopping</span>
                        </button>
                        <button onclick="showSection('transport-section')" class="grid-button">
                            <i data-lucide="bus" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Getting Around</span>
                        </button>
                        <button onclick="showSection('important-section')" class="grid-button">
                            <i data-lucide="siren" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Important Info</span>
                        </button>
                        <button onclick="showSection('departure-section')" class="grid-button">
                            <i data-lucide="log-out" class="w-10 h-10 text-blue-500 mb-2"></i>
                            <span class="font-semibold text-gray-700">Departure</span>
                        </button>
                    </div>
                </main>
            </div>
        </div>

        <!-- AI Assistant Section -->
        <div id="ai-assistant-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200">
                    <i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i>
                </button>
                <div class="flex items-center mx-auto">
                    <i data-lucide="bot" class="w-8 h-8 text-blue-500 mr-3"></i>
                    <h2 class="text-xl font-bold text-gray-800">Phaedra AI Assistant</h2>
                </div>
            </header>
            <div id="ai-chat-messages">
                <!-- Chat messages will be appended here -->
            </div>
            <div id="ai-chat-input-area">
                <div class="flex justify-center mb-2">
                    <button id="plan-day-btn" class="text-sm bg-purple-100 text-purple-700 px-4 py-2 rounded-full font-semibold hover:bg-purple-200 transition">✨ Plan My Day</button>
                </div>
                <form id="ai-chat-form" class="flex items-center gap-2">
                    <input type="text" id="ai-chat-input" placeholder="Ask about your stay..." class="w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        <i data-lucide="send" class="w-6 h-6"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- All Content Sections -->
        <div id="welcome-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md">
                <button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button>
                <h2 class="text-xl font-bold text-gray-800 mx-auto">Welcome to Paradise!</h2>
            </header>
            <div class="p-6 prose-custom">
                <h3 class="text-2xl font-bold mb-4">Kalós órises!</h3>
                <p class="mb-4">Welcome to Kos, and welcome to Diamante del Mar Phaedra. We are absolutely delighted to host you on this enchanting Dodecanese island. Recently renovated and designed with style and comfort in mind, we hope our home serves as your perfect sanctuary to explore the captivating blend of ancient history, sun-drenched beaches, and vibrant island life that makes Kos so special.</p>
                <p class="mb-4">Kos invites you to slow down, breathe in the sea air, wander through millennia of history, and savour the simple pleasures. We hope you fall in love with its unique charm just as we have.</p>
                <h3 class="text-xl font-semibold mt-6 mb-2">About This Guide</h3>
                <p>Think of this book as your curated introduction to living like a stylish local. We've gathered essential information to help you settle in effortlessly, alongside our personal recommendations for discovering the island's highlights. Now, relax, unwind, and let your Kos story begin!</p>
            </div>
        </div>

        <div id="essentials-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Apartment Info</h2></header>
            <div class="p-6 space-y-6">
                <div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="map-pin" class="w-5 h-5 mr-2 text-blue-500"></i>Address</h3><p class="text-gray-600">Diamante Del Mar Phaedra</p><p class="text-gray-600">Σοφοκλή Βενιζέλου 54 (Sophokli Venizelou 54)</p><p class="text-gray-600">Kos Town, 853 00</p><a href="https://www.google.com/maps/search/?api=1&query=Diamante+Del+Mar+Phaedra,+Sophokli+Venizelou+54,+Kos+Town,+85300" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">Open in Maps <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div>
                <div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="clock" class="w-5 h-5 mr-2 text-blue-500"></i>Check-in & Out</h3><p class="text-gray-600"><strong>Check-in:</strong> After 16:00 (4:00 PM)</p><p class="text-gray-600"><strong>Lockbox Code:</strong> 1723</p><p class="text-gray-600 mt-2"><strong>Check-out:</strong> By 11:00 AM</p><p class="text-gray-500 text-sm mt-1">Please leave keys on the Lock Box.</p></div>
                <div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="wifi" class="w-5 h-5 mr-2 text-blue-500"></i>Wi-Fi Access</h3><p class="text-gray-600"><strong>Network:</strong> Phaedra</p><div class="flex justify-between items-center mt-1"><p class="text-gray-600"><strong>Password:</strong> <span id="wifi-password">Phaedra!22420@</span></p><button onclick="copyToClipboard('#wifi-password')" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm font-semibold hover:bg-blue-600">Copy</button></div></div>
                <div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="home" class="w-5 h-5 mr-2 text-blue-500"></i>House Rules</h3><ul class="list-disc list-inside text-gray-600 space-y-1"><li><strong>Strictly non-smoking</strong> indoors.</li><li><strong>No pets</strong> allowed.</li><li>Quiet hours: <strong>22:00 - 07:00</strong>.</li><li><strong>No parties</strong> or large gatherings.</li><li>Only registered guests may stay overnight.</li></ul></div>
                <div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="book-open" class="w-5 h-5 mr-2 text-blue-500"></i>Appliance Manuals</h3><p class="text-gray-600 mb-4">Scan the QR code with your phone's camera to view the manual for each appliance.</p><div class="grid grid-cols-2 gap-4 text-center"><div><p class="font-medium text-gray-700">Microwave</p><a href="https://www.grundig.com/content/dam/rainbow-grundig-greece-gr-aem/rainbow-grundig-greece-gr-aemProductCatalog/product-documents/8897453600-GMI-12311-B/en-US-8897453600-20221020135181-User-Manual---File-Longsv-SE.pdf"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.grundig.com/content/dam/rainbow-grundig-greece-gr-aem/rainbow-grundig-greece-gr-aemProductCatalog/product-documents/8897453600-GMI-12311-B/en-US-8897453600-20221020135181-User-Manual---File-Longsv-SE.pdf" alt="QR Code for Microwave Manual" class="mx-auto mt-1 rounded-lg"></a></div><div><p class="font-medium text-gray-700">Oven</p><a href="https://www.grundig.com/content/dam/rainbow-grundig-greece-gr-aem/rainbow-grundig-greece-gr-aemProductCatalog/product-documents/7768282928-Edition-75-Backofenset/en-US-7768282928-202311021237674-User-Manual---File-Longen-US.pdf"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.grundig.com/content/dam/rainbow-grundig-greece-gr-aem/rainbow-grundig-greece-gr-aemProductCatalog/product-documents/7768282928-Edition-75-Backofenset/en-US-7768282928-202311021237674-User-Manual---File-Longen-US.pdf" alt="QR Code for Oven Manual" class="mx-auto mt-1 rounded-lg"></a></div><div><p class="font-medium text-gray-700">Nespresso Coffee machine</p><a href="https://www.nespresso.com/shared_res/manuals/essenza-mini/2017/UM_NESPRESSO_ESSENZA_MINI_KRUPS_PROD_WEB_2017_02_20.pdf"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.nespresso.com/shared_res/manuals/essenza-mini/2017/UM_NESPRESSO_ESSENZA_MINI_KRUPS_PROD_WEB_2017_02_20.pdf" alt="QR Code for Nespresso Manual" class="mx-auto mt-1 rounded-lg"></a></div><div><p class="font-medium text-gray-700">Washing Machine</p><a href="https://morris.gr/wp-content/uploads/2023/12/Instructions-manual-WIW-81411BI.pdf"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://morris.gr/wp-content/uploads/2023/12/Instructions-manual-WIW-81411BI.pdf" alt="QR Code for Washing Machine Manual" class="mx-auto mt-1 rounded-lg"></a></div></div></div>
            </div>
        </div>

        <div id="guide-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Island Guide</h2></header>
            <div class="p-6 space-y-8">
                <div class="card overflow-hidden p-0 bg-blue-50 border border-blue-200"><img src="https://images.unsplash.com/photo-1551028150-64b9f398f67b?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://xasapaki.gr/wp-content/uploads/2023/05/DSC01818-scaled.jpg';" alt="A perfectly grilled steak" class="w-full h-40 object-cover"><div class="p-4"><h3 class="font-bold text-xl mb-2 text-blue-800 flex items-center"><i data-lucide="star" class="w-6 h-6 mr-2 text-yellow-500 fill-current"></i>Host's Top Pick: Xasapaki</h3><p class="text-blue-700 mb-3">For an unforgettable meal, visit Xasapaki. It's a unique butcher shop and steakhouse where you pick your cut of meat and they grill it to perfection. Their burgers are legendary!</p><div class="flex flex-wrap gap-2"><a href="https://xasapaki.gr/" target="_blank" class="inline-flex items-center bg-blue-600 text-white px-3 py-1 rounded-lg font-semibold hover:bg-blue-700 text-sm">Visit Website</a><a href="https://www.google.com/maps/search/?api=1&query=Xasapaki+Kos" target="_blank" class="inline-flex items-center bg-gray-200 text-gray-700 px-3 py-1 rounded-lg font-semibold hover:bg-gray-300 text-sm">View on Map</a><button class="meal-suggester-btn bg-green-100 text-green-700 px-3 py-1 rounded-lg font-semibold hover:bg-green-200 text-sm" data-restaurant="Xasapaki" data-desc="A unique butcher shop and steakhouse where you pick your cut of meat and they grill it to perfection. Their burgers are legendary!">✨ Suggest a Meal</button></div></div></div>
                <div><h3 class="text-2xl font-bold mb-4 text-gray-800">Dining & Coffee</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1559305459-49de9734d355?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://imageproxy.wolt.com/assets/67335dc042b21b5c7ee59154';" alt="A delicious brunch spread" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Alchimion & The Cup</h4><p class="text-gray-600 mt-1">Your go-to spots for breakfast, brunch, and specialty coffee.</p><a href="https://www.google.com/maps/search/?api=1&query=Alchimion+%26+The+Cup,+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1541592106381-b5863c023904?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://www.athinorama.gr/Content/ImagesDatabase/p/750x422/crop/both/a5/a5468d17cae94a7dad807007ceefddf8.jpg?quality=81&404=default&v=4';" alt="Fresh seafood pasta" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Barbouni</h4><p class="text-gray-600 mt-1">Top choice for fresh seafood by the water near the port.</p><div class="flex flex-wrap gap-2 mt-2"><a href="https://www.google.com/maps/search/?api=1&query=Barbouni+Kos" target="_blank" class="inline-flex items-center text-blue-600 font-semibold hover:underline text-sm">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a><button class="meal-suggester-btn bg-green-100 text-green-700 px-3 py-1 rounded-lg font-semibold hover:bg-green-200 text-sm" data-restaurant="Barbouni" data-desc="Top choice for fresh seafood by the water near the port.">✨ Suggest a Meal</button></div></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1622234994112-c94831e67991?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://media-01.imu.nl/storage/ourplanetinmylens.com/21978/restaurants-kos-greece-patriko-800x533.jpg';" alt="A spread of Greek meze" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Patriko</h4><p class="text-gray-600 mt-1">A family-run gem for authentic Greek meze. Try the baked feta with honey.</p><div class="flex flex-wrap gap-2 mt-2"><a href="https://www.google.com/maps/search/?api=1&query=Patriko+Restaurant+Kos" target="_blank" class="inline-flex items-center text-blue-600 font-semibold hover:underline text-sm">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a><button class="meal-suggester-btn bg-green-100 text-green-700 px-3 py-1 rounded-lg font-semibold hover:bg-green-200 text-sm" data-restaurant="Patriko" data-desc="A family-run gem for authentic Greek meze. Try the baked feta with honey.">✨ Suggest a Meal</button></div></div></div></div></div>
                <div><h3 class="text-2xl font-bold mb-4 text-gray-800">Beaches</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1625450438349-5975e50cf582?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://media.jet2.com/is/image/jet2/313976-kgs_lambi_0813_02_ps?$Original-Dynamic(max1280x1280)$&wid=1920&hei=500&fit=crop%2C1&dpr=off';" alt="Sandy beach with umbrellas" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Lambi Beach</h4><p class="text-gray-600 mt-1">Your closest neighbour! A popular sandy stretch perfect for a quick swim.</p><a href="https://www.google.com/maps/search/?api=1&query=Lambi+Beach+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1628189531122-8353e813a8c5?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://www.jet2holidays.com/-/media/destination%20guide/greece/kos/cfu_agios_stefanos_beach_1497481107_getty_1023_01_rgb-136-dpi-for-web-min.jpg?h=500&w=1920&crop=1&hash=6B2D4846664312303EC275100A9440EB%201024w';" alt="Beach with a church on an islet" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Agios Stefanos</h4><p class="text-gray-600 mt-1">Arguably Kos's most photogenic beach, with views of Kastri islet.</p><a href="https://www.google.com/maps/search/?api=1&query=Agios+Stefanos+Beach+Kefalos+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1617066808546-32d56a237190?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://www.reckonasbavi.cz/wp-content/uploads/2023/08/Therma-beach-Embros-prirodni-termalni-lazne-na-ostrove-Kos.jpg.jpg';" alt="Rocky beach with hot springs" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Therma Beach</h4><p class="text-gray-600 mt-1">A unique natural spa experience where hot springs flow into the sea.</p><a href="https://www.google.com/maps/search/?api=1&query=Therma+Beach+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1507525428034-b723a996f329?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://www.vacanzekos.com/wp-content/uploads/2016/02/paradise-beach.jpg';" alt="A stunning sandy beach with turquoise water" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Paradise Beach</h4><p class="text-gray-600 mt-1">Golden sand and shallow, calm waters make this beach perfect for families.</p><a href="https://www.google.com/maps/search/?api=1&query=Paradise+Beach+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div></div></div>
                <div><h3 class="text-2xl font-bold mb-4 text-gray-800">History & Villages</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1628189531233-a3a2de7c858e?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://www.vacanzegreche.com/public/img/data/2019101794859527_asklepion-isola-di-kos.jpg'" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">The Asklepion</h4><p class="text-gray-600 mt-1">The island's most important archaeological site, linked to Hippocrates.</p><a href="https://www.google.com/maps/search/?api=1&query=Asklepion+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1540899979346-a4c4987053e4?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://as1.ftcdn.net/jpg/02/95/44/86/1000_F_295448668_PNfl3bFQOS2eT3vWez1r1MlrlhyB0TFF.webp';" alt="Sunset over a Greek village" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Zia Village</h4><p class="text-gray-600 mt-1">A must-visit mountain village for breathtaking sunset views.</p><a href="https://www.google.com/maps/search/?api=1&query=Zia+Village+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div><div class="card overflow-hidden p-0"><img src="https://images.unsplash.com/photo-1628189531065-a8a4f0b2f5d7?q=80&w=800&auto=format&fit=crop" onerror="this.onerror=null;this.src='https://a.travel-assets.com/findyours-php/viewfinder/images/res70/73000/73702-Kos-Castle.jpg';" alt="A stone castle by the sea" class="w-full h-32 object-cover"><div class="p-4"><h4 class="font-semibold text-lg">Neratzia Castle</h4><p class="text-gray-600 mt-1">An impressive 15th-century castle guarding the harbour entrance.</p><a href="https://www.google.com/maps/search/?api=1&query=Neratzia+Castle+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div></div></div></div>
            </div>
        </div>
        
        <div id="transport-section" class="section-screen">
             <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Getting Around Kos</h2></header>
            <div class="p-6 space-y-6"><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="car" class="w-5 h-5 mr-2 text-blue-500"></i>Rental Car / Scooter</h3><p class="text-gray-600">Highly recommended for the most freedom to explore remote beaches and villages. Book in advance during summer.</p></div><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="bus" class="w-5 h-5 mr-2 text-blue-500"></i>KTEL Intercity Buses</h3><p class="text-gray-600">An economical way to travel between major towns and resorts. The main station is at 7 Kleopatras Street. Check schedules online at <a href="http://www.ktel-kos.gr" target="_blank" class="text-blue-600 hover:underline">ktel-kos.gr</a>.</p><a href="https://www.google.com/maps/search/?api=1&query=KTEL+Bus+Station+Kleopatras+7+Kos" target="_blank" class="inline-flex items-center mt-2 text-blue-600 font-semibold hover:underline">View Station on Map <i data-lucide="external-link" class="w-4 h-4 ml-1"></i></a></div><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="bike" class="w-5 h-5 mr-2 text-blue-500"></i>Cycling</h3><p class="text-gray-600">Kos's flat terrain makes cycling a great option for short distances, especially along the coast. Rentals are widely available.</p></div><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="taxi" class="w-5 h-5 mr-2 text-blue-500"></i>Taxis</h3><p class="text-gray-600">Readily available. Find them at ranks or book by phone. Agree on a price for long journeys. Kos Town Radio Taxi: <a href="tel:+302242022777" class="text-blue-600 hover:underline">+30 22420 22777</a></p></div></div>
        </div>

        <div id="important-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Important Info</h2></header>
            <div class="p-6 space-y-6"><div class="card p-6 border-2 border-red-500"><h3 class="font-semibold text-lg mb-2 flex items-center text-red-600"><i data-lucide="siren" class="w-5 h-5 mr-2"></i>Emergency Numbers</h3><p class="text-gray-700 text-lg">For any emergency, call:</p><a href="tel:112" class="block text-center my-3 text-3xl font-bold text-red-600 bg-red-100 p-4 rounded-lg tracking-widest">112</a><ul class="list-disc list-inside text-gray-600 space-y-1"><li><strong>Ambulance:</strong> 166</li><li><strong>Police:</strong> 100</li><li><strong>Fire Department:</strong> 199</li></ul></div><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="user" class="w-5 h-5 mr-2 text-blue-500"></i>Host Contact</h3><p class="text-gray-600"><strong>Name:</strong> Varthakouris Ioannis</p><p class="text-gray-600"><strong>Phone / WhatsApp:</strong></p><a href="https://wa.me/306942575314" target="_blank" class="block text-center my-2 text-xl font-semibold text-green-600 bg-green-100 p-3 rounded-lg hover:bg-green-200">+30 6942 575314</a><p class="text-sm text-gray-500">WhatsApp is preferred for non-urgent queries (9 AM - 8 PM). Please call for urgent issues.</p></div><div class="card p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="shopping-cart" class="w-5 h-5 mr-2 text-blue-500"></i>Nearby Essentials</h3><p class="text-gray-600"><strong>Supermarket:</strong> AB Vassilopoulos is just a 1-minute walk away for groceries.</p><p class="text-gray-600 mt-2"><strong>ATM:</b> Available at the entrance of the AB Vassilopoulos supermarket.</p><p class="text-gray-600 mt-2"><strong>Pharmacy (Φαρμακείο):</strong> Several nearby. Look for a green cross sign. A list of on-duty pharmacies is posted on their doors.</p></div></div>
        </div>

        <div id="departure-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Until Next Time...</h2></header>
            <div class="p-6 prose-custom">
                <h3 class="text-2xl font-bold mb-4">A Fond Farewell</h3>
                <p class="mb-4">As your time on the beautiful island of Kos draws to a close, we want to extend our sincerest thanks for choosing to stay with us. We truly hope you've had a wonderful and memorable holiday.</p>
                <div class="card my-6 bg-blue-50 p-6"><h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="check-circle" class="w-5 h-5 mr-2 text-blue-500"></i>Check-out Reminder</h3><ul class="list-disc list-inside text-gray-600 space-y-1"><li>Check-out time is by <strong>11:00 AM</strong>.</li><li>Please leave the <strong>keys in the lockbox</strong>.</li><li>Ensure all personal belongings are packed.</li><li>Turn off all lights and A/C units.</li></ul></div>
                
                <!-- AI Review Assistant -->
                <div class="card my-6 p-6">
                    <h3 class="font-semibold text-lg mb-2 flex items-center"><i data-lucide="pen-square" class="w-5 h-5 mr-2 text-purple-500"></i>AI Review Assistant</h3>
                    <p class="text-gray-600 mb-3">Enjoyed your stay? Jot down a few notes below and let our AI help you craft the perfect review!</p>
                    <textarea id="review-notes" class="w-full p-2 border border-gray-300 rounded-lg" rows="3" placeholder="e.g., Loved the sea view, apartment was spotless, host was very helpful..."></textarea>
                    <button id="draft-review-btn" class="mt-3 w-full bg-purple-500 text-white py-2 rounded-lg font-semibold hover:bg-purple-600 transition">✨ Draft My Review</button>
                </div>

                <h3 class="text-xl font-semibold mt-6 mb-2">Share Your Experience</h3>
                <p>We would be incredibly grateful if you could leave a review on the platform you used for booking or in our <a href="https://g.page/r/CbUXM_AzUnc5EAE/review" target="_blank" class="text-blue-600 hover:underline">Google Business Profile</a>.</p>
                <h3 class="text-xl font-semibold mt-6 mb-2">Stay Connected</h3>
                <p>Follow us on Instagram <a href="https://www.instagram.com/diamantedelmar.phaedra" target="_blank" class="text-blue-600 hover:underline">@diamantedelmar.phaedra</a>.</p>
                <p class="mt-8">Thank you once again. We wish you a safe and pleasant journey onwards!</p>
            </div>
        </div>
        
        <div id="events-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">HIPPOCRATEIA 2025</h2></header>
            <div class="p-6"><div class="mb-6"><label for="event-date-filter" class="block text-gray-700 text-sm font-bold mb-2">Filter by Date:</label><input type="date" id="event-date-filter" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"></div><div id="events-list" class="grid grid-cols-1 gap-8"></div><div id="no-events-message" class="text-center text-gray-600 mt-8 hidden">No events found for the selected date.</div></div>
        </div>

        <div id="local-products-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Local Products of Kos</h2></header>
            <div class="p-6 space-y-8">
                <p class="text-gray-700 mb-4">Kos is rich in local produce and traditional goods that make for wonderful souvenirs. Here are some of our favorites:</p>
                <div class="card overflow-hidden p-0">
                    <img src="https://melitaygetos.gr/wp-content/uploads/2021/05/meli-1.jpg" onerror="this.onerror=null;this.src='https://www.kos.gr/sites/default/files/styles/flexslider_full/public/2020-03/melikoukouvas.jpg?itok=f4f4f4f4';" alt="Kos Honey" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-xl mb-2 text-gray-800">Kos Honey</h3>
                        <p class="text-gray-600 mb-2">Kos is known for its excellent thyme honey, rich in aroma and flavor. It's a natural sweetener and a healthy treat.</p>
                        <button class="product-story-btn w-full bg-yellow-100 text-yellow-800 px-3 py-2 rounded-lg font-semibold hover:bg-yellow-200 text-sm" data-product="Kos Honey" data-desc="Excellent thyme honey, rich in aroma and flavor.">✨ Tell Me More</button>
                    </div>
                </div>
                <div class="card overflow-hidden p-0">
                    <img src="https://gastronomytours.com/wp-content/uploads/2023/09/Possa-768x443.jpg" onerror="this.onerror=null;this.src='https://www.kos.gr/sites/default/files/styles/flexslider_full/public/2020-03/tyriposa.jpg?itok=f4f4f4f4';" alt="Posa Cheese" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-xl mb-2 text-gray-800">Posa Cheese (Wine Cheese)</h3>
                        <p class="text-gray-600 mb-2">A unique local cheese, "Posa" is traditionally aged in red wine sediment, giving it a distinctive reddish hue and a rich, spicy flavor.</p>
                         <button class="product-story-btn w-full bg-yellow-100 text-yellow-800 px-3 py-2 rounded-lg font-semibold hover:bg-yellow-200 text-sm" data-product="Posa Cheese" data-desc="A unique local cheese aged in red wine sediment, giving it a distinctive reddish hue and a rich, spicy flavor.">✨ Tell Me More</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="itinerary-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">5-Day Kos Itinerary</h2></header>
            <div class="p-6 space-y-8"><!-- Itinerary content here --></div>
        </div>

        <div id="island-hopping-section" class="section-screen">
            <header class="section-header p-4 flex items-center shadow-md"><button onclick="goBack()" class="p-2 rounded-full hover:bg-gray-200"><i data-lucide="arrow-left" class="w-6 h-6 text-gray-700"></i></button><h2 class="text-xl font-bold text-gray-800 mx-auto">Island Hopping from Kos</h2></header>
            <div class="p-6 space-y-8"><!-- Island hopping content here --></div>
        </div>


    </div>

    <!-- Modal for AI responses -->
    <div id="ai-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4"></h3>
            <div id="modal-body" class="text-gray-600 space-y-2"></div>
            <div id="modal-loader" class="text-center hidden">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="mt-2 text-gray-500">Phaedra is thinking...</p>
            </div>
            <button id="modal-close-btn" class="mt-6 w-full bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600">Close</button>
            <button id="modal-copy-btn" class="mt-2 w-full bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 hidden">Copy Text</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
        Message copied!
    </div>

    <script>
        // --- DATA & CONFIG ---
        const events = [
            { date: "SATURDAY 21/06/25 & SUNDAY 22/06/25", time: "SATURDAY 19:00 (OPENING), SUNDAY 18:00-20:00 (OPERATING HOURS)", title: "PAINTING AND HAGIOGRAPHY EXHIBITION", description: "Exhibition of works by the students of the Painting & Hagiography Workshop FRIDART of Maria Vamvakousi.", location: "HISTORICAL & FOLKLORE MUSEUM OF KOS", googleMaps: "https://www.google.com/maps/search/?api=1&query=HISTORICAL+%26+FOLKLORE+MUSEUM+OF+KOS", gCalStart: "20250621T190000", gCalEnd: "20250622T200000" },
            { date: "TUESDAY 24/06/25", time: "19:00", title: "CONCERT WITH THE STUDENTS OF MARIA ORFANOUDAKI'S MUSIC SCHOOL", description: "Student concert of classical and contemporary music.", location: "COURTYARD OF THE FOLKLORE & HISTORICAL MUSEUM OF KOS", googleMaps: "https://www.google.com/maps/search/?api=1&query=HISTORICAL+%26+FOLKLORE+MUSEUM+OF+KOS", gCalStart: "20250624T190000", gCalEnd: "20250624T210000" },
            { date: "FRIDAY 25/07/25", time: "21:00", title: "CONCERT WITH MARINA SATTI", description: "Ticketed event.", location: "KOS MARINA", googleMaps: "https://www.google.com/maps/search/?api=1&query=KOS+MARINA", gCalStart: "20250725T210000", gCalEnd: "20250725T230000" },
            { date: "MONDAY 28/07/25", time: "22:00", title: "CONCERT WITH ELENA PAPARIZOU", description: "Ticketed event.", location: "PYLI FOOTBALL FIELD", googleMaps: "https://www.google.com/maps/search/?api=1&query=PYLI+FOOTBALL+FIELD+KOS", gCalStart: "20250728T220000", gCalEnd: "20250728T235900" },
        ];
        const chatHistory = [];
        let knowledgeBase = '';

        // --- UI & NAVIGATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            knowledgeBase = buildKnowledgeBase();
        });
        
        let currentSection = null;
        const homeScreen = document.getElementById('home-screen');

        function showSection(sectionId) {
            homeScreen.style.display = 'none';
            const section = document.getElementById(sectionId);
            if (section) {
                document.querySelectorAll('.section-screen.active').forEach(s => s.classList.remove('active'));
                section.classList.add('active');
                currentSection = section;
                section.scrollTop = 0;
                
                if (sectionId === 'events-section') {
                    renderEvents();
                } else if (sectionId === 'ai-assistant-section' && !document.querySelector('#ai-chat-messages .chat-bubble')) {
                    addMessageToChat("Hello! I'm Phaedra, your personal AI assistant. How can I help you today? You can ask me about the apartment, for recommendations, or even ask me to plan your day!", 'assistant');
                }
            }
        }

        function goBack() {
            if (currentSection) {
                currentSection.classList.remove('active');
                currentSection = null;
            }
            setTimeout(() => { homeScreen.style.display = 'block'; }, 300);
        }

        // --- UTILITIES ---
        function copyToClipboard(selectorOrText, isText = false) {
            const textToCopy = isText ? selectorOrText : document.querySelector(selectorOrText).innerText;
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast(isText ? 'Review copied!' : 'Password copied!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                showToast('Failed to copy.');
            }
            document.body.removeChild(textArea);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 2000);
        }
        
        // --- MODAL LOGIC ---
        const modal = document.getElementById('ai-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalLoader = document.getElementById('modal-loader');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalCopyBtn = document.getElementById('modal-copy-btn');

        function showModal(title, showCopy = false) {
            modalTitle.textContent = title;
            modalBody.innerHTML = '';
            modalBody.classList.add('hidden');
            modalLoader.classList.remove('hidden');
            modalCopyBtn.style.display = showCopy ? 'block' : 'none';
            modal.classList.add('active');
        }

        function updateModal(content) {
            modalLoader.classList.add('hidden');
            modalBody.innerHTML = content;
            modalBody.classList.remove('hidden');
        }

        function hideModal() {
            modal.classList.remove('active');
        }
        modalCloseBtn.addEventListener('click', hideModal);
        modalCopyBtn.addEventListener('click', () => copyToClipboard(modalBody.innerText, true));
        modal.addEventListener('click', (e) => {
            if (e.target === modal) hideModal();
        });

        // --- EVENTS SECTION LOGIC ---
        function generateGoogleCalendarLink(event) { /* ... same as before ... */ }
        
        function renderEvents() {
            const eventsList = document.getElementById('events-list');
            const noEventsMessage = document.getElementById('no-events-message');
            eventsList.innerHTML = ''; 
            noEventsMessage.classList.add('hidden');

            const filteredEvents = events; // Simplified for this example

            if (filteredEvents.length === 0) {
                noEventsMessage.classList.remove('hidden');
            } else {
                filteredEvents.forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'card p-6 flex flex-col justify-between';
                    
                    let buttons = `<a href="${event.googleMaps}" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 flex items-center text-sm"><i class="fas fa-external-link-alt mr-2"></i> View on Map</a>`;
                    if (event.description.length > 150) {
                        buttons += `<button class="event-summarizer-btn bg-yellow-100 text-yellow-800 px-3 py-2 rounded-lg font-semibold hover:bg-yellow-200 text-sm" data-title="${event.title}" data-desc="${event.description}">✨ Summarize</button>`;
                    }

                    eventCard.innerHTML = `
                        <div>
                            <h2 class="text-2xl font-bold mb-2">${event.title}</h2>
                            <p class="text-lg mb-2 text-orange-600 font-bold"><i class="far fa-calendar-alt mr-2"></i>${event.date}</p>
                            <p class="text-gray-700 mb-1"><i class="far fa-clock mr-2"></i>${event.time || ''}</p>
                            <p class="text-green-700 font-semibold text-md mb-3"><i class="fas fa-map-marker-alt mr-2"></i>${event.location}</p>
                            <p class="text-gray-600 text-sm mb-4">${event.description}</p>
                        </div>
                        <div class="flex flex-wrap items-center justify-start gap-3 mt-4">${buttons}</div>`;
                    eventsList.appendChild(eventCard);
                });
                addEventListenersToDynamicButtons();
            }
        }

        // --- GEMINI API INTEGRATION & AI LOGIC ---
        function buildKnowledgeBase() {
            let content = '';
            const contentSections = ['welcome-section', 'essentials-section', 'guide-section', 'transport-section', 'important-section', 'departure-section', 'itinerary-section', 'local-products-section', 'island-hopping-section'];
            contentSections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    content += `\n\n--- START OF SECTION: ${id} ---\n`;
                    content += section.innerText;
                    content += `\n--- END OF SECTION: ${id} ---\n`;
                }
            });
            return content;
        }

        async function getGeminiResponse(prompt, useChatHistory = true) {
            const historyToUse = useChatHistory ? chatHistory : [];
            const payload = { contents: [...historyToUse, { role: "user", parts: [{ text: prompt }] }] };
            const apiKey = "AIzaSyDd1fUY4syyAvclAWcVo0mr8nsnvbAZLQ4"; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    if (useChatHistory) {
                      chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                      chatHistory.push({ role: "model", parts: [{ text: text }] });
                    }
                    return text;
                }
                return "I'm having a little trouble thinking right now. Please try again.";
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return "I couldn't connect to my brain. Please check your connection.";
            }
        }

        const chatForm = document.getElementById('ai-chat-form');
        const chatInput = document.getElementById('ai-chat-input');
        const chatMessages = document.getElementById('ai-chat-messages');

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (userInput) {
                addMessageToChat(userInput, 'user');
                chatInput.value = '';
                showTypingIndicator();
                const prompt = `You are Phaedra, a friendly AI assistant for guests at Diamante del Mar Phaedra in Kos, Greece. Your knowledge is based SOLELY on the provided welcome book content. Do not invent information. Today's date is July 23, 2025. Based on the following content, answer the user's question concisely. Welcome Book Content: """${knowledgeBase}""" User's question: "${userInput}"`;
                const response = await getGeminiResponse(prompt);
                removeTypingIndicator();
                addMessageToChat(response, 'assistant');
            }
        });
        
        document.getElementById('plan-day-btn').addEventListener('click', () => {
            const interests = prompt("What are you in the mood for today? (e.g., history, beaches, food, relaxation)");
            if (interests) planMyDay(interests);
        });

        async function planMyDay(interests) {
            addMessageToChat(`I'd like a one-day plan focusing on: ${interests}`, 'user');
            showTypingIndicator();
            const prompt = `You are Phaedra, a helpful AI travel planner for Kos. Based on the provided guide content, create a personalized one-day itinerary for a tourist whose interests are "${interests}". Include morning, afternoon, and evening activities with specific places mentioned in the guide. Present it in a friendly, structured format with markdown for headings. Guide Content: """${knowledgeBase}"""`;
            const response = await getGeminiResponse(prompt);
            removeTypingIndicator();
            addMessageToChat(response, 'assistant');
        }

        function addEventListenersToDynamicButtons() {
            document.querySelectorAll('.event-summarizer-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const { title, desc } = e.currentTarget.dataset;
                    showModal(`Summary for ${title}`);
                    const prompt = `Summarize the following event description in one or two clear, concise sentences. Description: "${desc}"`;
                    const response = await getGeminiResponse(prompt, false);
                    updateModal(response.replace(/\n/g, '<br>'));
                });
            });
        }
        
        document.querySelectorAll('.product-story-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const { product, desc } = e.currentTarget.dataset;
                showModal(`About ${product}`);
                const prompt = `You are a creative storyteller. Based on the following description of a local product from Kos, Greece, write a short, engaging paragraph (3-4 sentences) that tells a little story or gives interesting cultural context about it. Make it sound appealing to a tourist. Product: ${product}. Description: "${desc}"`;
                const response = await getGeminiResponse(prompt, false);
                updateModal(response.replace(/\n/g, '<br>'));
            });
        });
        
        document.getElementById('draft-review-btn').addEventListener('click', async () => {
            const notes = document.getElementById('review-notes').value;
            if (!notes.trim()) {
                alert("Please enter some notes about your stay first!");
                return;
            }
            showModal("Your AI-Drafted Review", true);
            const prompt = `You are a helpful AI assistant. A guest at a vacation rental in Kos, Greece, has provided the following notes about their stay. Turn these notes into a well-written, positive, and friendly review. Structure it into a few paragraphs. Notes: "${notes}"`;
            const response = await getGeminiResponse(prompt, false);
            updateModal(response.replace(/\n/g, '<br>'));
        });

        function addMessageToChat(message, sender) {
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble', sender);
            bubble.innerHTML = message.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            chatMessages.appendChild(bubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingBubble = document.createElement('div');
            typingBubble.id = 'typing-indicator';
            typingBubble.classList.add('chat-bubble', 'assistant', 'typing');
            typingBubble.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
            chatMessages.appendChild(typingBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }
    </script>
</body>
</html>
